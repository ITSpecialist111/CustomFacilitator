<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ally Aura - Age UK in Microsoft Teams</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/ITSpecialist111/CustomFacilitator/main/AGELogo.png?raw=true">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #201F1F; /* Teams Dark Theme BG */
        }
        .teams-bg { background-color: #201F1F; }
        .teams-secondary-bg { background-color: #292828; }
        .teams-header-bg { background-color: #333232; }
        .teams-left-rail-bg { background-color: #333232; }
        .teams-icon-hover:hover { background-color: #4A4949; }
        .teams-active-icon { border-left: 2px solid #A6A6F6; color: #A6A6F6;}
        .highlight { background-color: rgba(251, 191, 36, 0.4); padding: 0 4px; border-radius: 3px; }
        .sentiment-positive { color: #10B981; }
        .sentiment-negative { color: #EF4444; }
        .sentiment-neutral { color: #6B7280; }
        .pulse-indicator { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 50% { opacity: .5; } }
        .facilitator-btn:disabled { background-color: #4B5563; cursor: not-allowed; opacity: 0.6; }
        .spinner { display: inline-block; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top: 2px solid #fff; width: 16px; height: 16px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .tab-btn.active { border-color: #A6A6F6; color: #E0E7FF; }
        .loop-component-bg { background-image: radial-gradient(#4B5563 1px, transparent 1px); background-size: 10px 10px; }
        .caller-pin {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #EF4444; /* Red */
            border: 2px solid white;
            box-shadow: 0 0 10px #EF4444, 0 0 20px #EF4444;
            transform: translate(-50%, -50%);
            animation: pulse-pin 1.5s infinite;
        }
        @keyframes pulse-pin {
            0% {
                transform: translate(-50%, -50%) scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); /* Red */
            }
            70% {
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); /* Red */
            }
            100% {
                transform: translate(-50%, -50%) scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); /* Red */
            }
        }
        .map-viewport { height: 220px; overflow: hidden; position: relative; background-color: #1f2937; border-radius: 0.5rem; }
        .map-image { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body class="text-gray-200 h-screen">
    <div class="flex h-full">
        <!-- Teams Left Nav Rail (Hidden on mobile) -->
        <nav class="w-16 teams-left-rail-bg hidden md:flex flex-col items-center justify-between py-2 flex-shrink-0">
            <div class="space-y-2">
                <button class="p-3 rounded teams-icon-hover"><i class="fas fa-bell"></i></button>
                <button class="p-3 rounded teams-icon-hover teams-active-icon"><i class="fas fa-comment-dots"></i></button>
                <button class="p-3 rounded teams-icon-hover"><i class="fas fa-calendar-alt"></i></button>
                <button class="p-3 rounded teams-icon-hover"><i class="fas fa-phone"></i></button>
                <button class="p-3 rounded teams-icon-hover"><i class="far fa-folder"></i></button>
            </div>
            <div class="space-y-2">
                 <button class="p-3 rounded teams-icon-hover"><i class="fas fa-th"></i></button>
                 <button class="p-3 rounded teams-icon-hover"><i class="fas fa-question-circle"></i></button>
            </div>
        </nav>
        
        <!-- Main Application Window -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Teams Header -->
            <header class="h-16 teams-header-bg flex items-center justify-between px-4 shadow-md z-10 flex-shrink-0">
                <div class="flex items-center space-x-2">
                    <span id="status-indicator" class="rounded-full w-3 h-3"></span>
                    <span id="meeting-timer" class="font-semibold">01:33</span>
                </div>
                <div class="flex-1 max-w-lg mx-4 hidden sm:block">
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" placeholder="Search" class="w-full bg-[#292828] rounded py-1.5 pl-9 pr-3 focus:outline-none focus:ring-2 focus:ring-[#A6A6F6]">
                    </div>
                </div>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <button class="teams-icon-hover px-2 py-1 rounded hidden sm:block">Chat</button>
                    <button class="teams-icon-hover px-2 py-1 rounded hidden sm:block">People</button>
                    <button class="teams-icon-hover px-2 py-1 rounded hidden md:block">React</button>
                    <button class="teams-icon-hover px-2 py-1 rounded hidden md:block">Apps</button>
                    <div class="w-px h-6 bg-gray-600 hidden sm:block"></div>
                    <button class="teams-icon-hover px-2 py-1 rounded"><i class="fas fa-video"></i></button>
                    <button class="teams-icon-hover px-2 py-1 rounded"><i class="fas fa-microphone"></i></button>
                    <a href="https://www.ageuk.org.uk/" target="_blank" rel="noopener noreferrer" class="bg-red-600 px-3 sm:px-4 py-1.5 rounded font-semibold hover:bg-red-700 text-sm sm:text-base">Leave</a>
                </div>
            </header>

            <!-- Main Content Area (Stack on mobile, side-by-side on desktop) -->
            <div class="flex flex-col md:flex-row flex-1 min-h-0">
                <!-- Meeting/Video Call Area -->
                <main class="flex-1 teams-bg p-4 flex flex-col gap-4 overflow-y-auto">
                    <!-- Participant Videos -->
                    <div class="bg-black rounded-lg shadow-lg relative flex-1 min-h-[50%]">
                        <img src="https://raw.githubusercontent.com/ITSpecialist111/CustomFacilitator/main/Daughter.png" alt="Main Speaker" class="object-cover w-full h-full rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/800x450/334155/E2E8F0?text=Participant';">
                        <span class="absolute bottom-2 left-2 sm:bottom-4 sm:left-4 bg-black bg-opacity-50 px-2 sm:px-3 py-1 rounded-md text-sm sm:text-lg font-semibold">Sarah (Daughter)</span>
                         <div id="emotion-indicator" class="absolute top-2 right-2 sm:top-4 sm:right-4 bg-red-600 px-3 py-1 rounded-full text-xs font-semibold">
                            <i class="fas fa-exclamation-triangle mr-1"></i>Distressed
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 flex-1 min-h-[33%]">
                         <div class="bg-black rounded-lg shadow-lg flex flex-col items-center justify-center relative">
                             <img src="https://raw.githubusercontent.com/ITSpecialist111/CustomFacilitator/main/Advisor.png" alt="Advisor" class="object-cover w-full h-full rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/400x225/1E3A8A/FFFFFF?text=You';">
                            <span class="absolute bottom-2 left-2 bg-black bg-opacity-50 px-2 py-1 rounded-md text-xs sm:text-sm">You (Advisor)</span>
                        </div>
                         <div class="bg-black rounded-lg shadow-lg flex flex-col items-center justify-center relative">
                            <div class="w-full h-full bg-gray-900 flex items-center justify-center rounded-lg relative">
                                <div id="agent-status" class="text-center">
                                    <img src="https://raw.githubusercontent.com/ITSpecialist111/CustomFacilitator/main/AGELogo.png?raw=true" alt="Ally Aura Logo" class="w-16 h-8 sm:w-20 sm:h-10 object-contain pulse-indicator">
                                    <div class="mt-2 text-xs sm:text-sm">
                                        <div id="agent-activity" class="text-indigo-400">Listening...</div>
                                    </div>
                                </div>
                            </div>
                            <span class="absolute bottom-2 left-2 bg-black bg-opacity-50 px-2 py-1 rounded-md text-xs sm:text-sm">Ally Aura</span>
                        </div>
                    </div>
                </main>
                
                <!-- Embedded Ally Aura Sidebar -->
                <aside id="agent-sidebar" class="w-full md:w-[28rem] teams-secondary-bg p-4 flex flex-col space-y-3 overflow-y-auto flex-shrink-0">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-bold flex items-center">
                            Ally Aura
                            <img src="https://raw.githubusercontent.com/ITSpecialist111/CustomFacilitator/main/AGELogo.png?raw=true" alt="Ally Aura Logo" class="w-12 h-6 ml-2 object-contain">
                        </h2>
                    </div>
                    <p class="text-xs text-gray-400">Powered by Azure AI & Semantic Kernel</p>
                    
                    <div class="flex border-b border-gray-700 text-sm overflow-x-auto">
                        <button class="tab-btn active font-semibold py-2 px-3 border-b-2 flex-shrink-0" data-tab="live">Live</button>
                        <button class="tab-btn text-gray-400 font-semibold py-2 px-3 border-b-2 border-transparent flex-shrink-0" data-tab="notes">Notes</button>
                        <button class="tab-btn text-gray-400 font-semibold py-2 px-3 border-b-2 border-transparent flex-shrink-0" data-tab="coaching">Coaching</button>
                        <button class="tab-btn text-gray-400 font-semibold py-2 px-3 border-b-2 border-transparent flex-shrink-0" data-tab="geo">Geography</button>
                        <button class="tab-btn text-gray-400 font-semibold py-2 px-3 border-b-2 border-transparent flex-shrink-0" data-tab="recap">Recap</button>
                    </div>

                    <!-- Live Insights Tab -->
                    <div id="tab-live" class="tab-content space-y-3">
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <h3 class="font-semibold mb-2 text-sm text-amber-400 flex items-center"><i class="fas fa-lightbulb mr-2"></i>Live Insights</h3>
                            <div id="insights" class="text-xs space-y-2"></div>
                        </div>
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <h3 class="font-semibold mb-2 text-sm text-yellow-400 flex items-center"><i class="fas fa-comment-dots mr-2"></i>Ally Aura Suggestions</h3>
                            <ul id="suggestions" class="text-xs space-y-2"></ul>
                        </div>
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <h3 class="font-semibold mb-2 text-sm text-green-400 flex items-center"><i class="fas fa-book-open mr-2"></i>The Bible - Knowledge Base</h3>
                            <div id="knowledge-base" class="text-xs space-y-2"></div>
                        </div>
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <h3 class="font-semibold mb-2 text-sm">Live Transcript</h3>
                            <div id="transcript" class="text-xs space-y-2 max-h-48 overflow-y-auto"></div>
                        </div>
                    </div>

                    <!-- Notes (Loop) Tab -->
                    <div id="tab-notes" class="tab-content hidden space-y-3">
                        <div class="bg-gray-800 p-3 rounded-lg">
                             <h3 class="font-semibold mb-2 text-sm flex items-center justify-between">
                                <span>Collaborative Meeting Notes</span>
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTYuNzUgMTJMMTAuMjUgMTguNzVIMTMuNzVMMTAuMjUgMTJMNy43NSA1LjI5SDQuMjVMMTAuMjUgMTguNzVIMTUuNzVMMjIgNS4yNUgxOC4yNUwxMy43NSA5Ljc1TDExLjI1IDE0LjI1TDkuNzUgMTIuNzVMMTYuNzUgNS4yNUgxMy4yNUw2Ljc1IDEyWiIgZmlsbD0idXJsKCNwYWludDBfbGluZWFyXzEzOF8yOTM5MikiIHRyYW5zZm9ybT0icm90YXRlKDE4MCwgMTIsIDEyKSIvPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyXzEzOF8yOTM5MiIgeDE9IjEzLjEyNSIgeTE9IjUuMjUiIHgyPSIxMy4xMjUiIHkyPSIxOC43NSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSIjNjk1NkNGIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0EyNjlFNyIvPgo8L2xpbmVhckdyYWRpZW50Pgo8L2RlZnM+Cjwvc3ZnPgo=" class="w-6 h-6" alt="MS Loop Logo"/>
                            </h3>
                            <p class="text-xs text-gray-400 mb-3">These notes are live and can be edited by all participants in the meeting's main "Notes" pane.</p>
                            <textarea id="loop-notes" class="w-full bg-gray-700 loop-component-bg rounded-md p-3 text-xs h-96 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-mono" placeholder="Live notes will appear here..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Coaching Tab -->
                    <div id="tab-coaching" class="tab-content hidden space-y-3">
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <h3 class="font-semibold mb-2 text-sm text-green-400">Conversation Quality</h3>
                            <p class="text-xs text-gray-400 mb-3">Assessment against 'what good looks like' criteria:</p>
                            <ul id="quality-indicators" class="text-xs space-y-2"></ul>
                        </div>
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <h3 class="font-semibold mb-2 text-sm text-blue-400">Improvement Suggestions</h3>
                            <p class="text-xs text-gray-400 mb-3">Constructive feedback based on the conversation:</p>
                            <ul id="improvement-suggestions" class="text-xs space-y-2"></ul>
                        </div>
                    </div>

                    <!-- Geography Tab -->
                    <div id="tab-geo" class="tab-content hidden space-y-3">
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <h3 class="font-semibold mb-2 text-sm text-cyan-400 flex items-center"><i class="fas fa-map-marker-alt mr-2"></i>Caller Location Context</h3>
                            <p class="text-xs text-gray-400 mb-3">Indices of Multiple Deprivation (IMD) map for Gloucestershire, showing the caller's location.</p>
                            <div class="relative rounded-lg overflow-hidden border-2 border-gray-700">
                                <div class="map-viewport">
                                    <img src="https://raw.githubusercontent.com/ITSpecialist111/CustomFacilitator/main/map.png" alt="Map of deprivation in Gloucestershire" class="map-image" onerror="this.onerror=null;this.src='https://placehold.co/600x400/4B5563/FFFFFF?text=Map+Unavailable';">
                                </div>
                                <div class="caller-pin" style="top: 50%; left: 28%;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Recap Tab -->
                    <div id="tab-recap" class="tab-content hidden space-y-3">
                        <div class="bg-gray-800 p-3 rounded-lg">
                            <h3 class="font-semibold mb-2 text-sm text-purple-400 flex items-center"><i class="fas fa-tasks mr-2"></i>Post-Meeting Recap</h3>
                            <div id="recap-summary" class="text-xs space-y-2 prose prose-invert prose-sm max-w-none"></div>
                            <button id="generate-recap-btn" class="facilitator-btn mt-4 w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-md font-semibold text-xs flex items-center justify-center">
                                <span class="btn-text">✨ Generate Full Recap</span>
                                <span class="spinner hidden"></span>
                            </button>
                            <button id="save-recap-btn" class="facilitator-btn mt-2 w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded-md font-semibold text-xs flex items-center justify-center disabled:opacity-50" disabled>
                                <i class="fas fa-save mr-2"></i>Save & Share Recap to OneDrive
                            </button>
                            <div id="save-feedback" class="text-green-400 text-xs mt-2 text-center hidden"><i class="fas fa-check mr-1"></i>Recap saved to OneDrive!</div>
                        </div>
                    </div>
                    
                    <!-- Buttons are now part of the agent, not a separate footer -->
                    <div class="text-center pt-4 border-t border-gray-700 mt-auto">
                        <div class="flex space-x-2 mb-3">
                            <button id="start-simulation" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-md font-semibold text-sm flex-1"><i class="fas fa-play mr-1"></i>Start Demo</button>
                            <button id="reset-simulation" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-md font-semibold text-sm"><i class="fas fa-refresh mr-1"></i>Reset</button>
                        </div>
                        <p class="text-xs text-gray-500">Scenario: Complex Housing & Benefits Crisis</p>
                    </div>
                </aside>
            </div>
        </div>
    </div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- UI Elements ---
    const startSimBtn = document.getElementById('start-simulation');
    const resetSimBtn = document.getElementById('reset-simulation');
    const emotionIndicator = document.getElementById('emotion-indicator');
    const agentActivity = document.getElementById('agent-activity');
    const generateRecapBtn = document.getElementById('generate-recap-btn');
    const saveRecapBtn = document.getElementById('save-recap-btn');
    const saveFeedback = document.getElementById('save-feedback');
    const meetingTimerEl = document.getElementById('meeting-timer');
    const statusIndicator = document.getElementById('status-indicator');

    // Content elements
    const transcriptEl = document.getElementById('transcript');
    const suggestionsEl = document.getElementById('suggestions');
    const knowledgeBaseEl = document.getElementById('knowledge-base');
    const insightsEl = document.getElementById('insights');
    const loopNotesEl = document.getElementById('loop-notes');
    const qualityIndicatorsEl = document.getElementById('quality-indicators');
    const improvementSuggestionsEl = document.getElementById('improvement-suggestions');
    const recapSummaryEl = document.getElementById('recap-summary');

    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    // --- State ---
    let fullTranscript = [];
    let simulationRunning = false;
    let currentStep = 0;
    let timerInterval = null;
    let secondsElapsed = 93; // Start at 01:33

    // --- Event Listeners & UI ---
    startSimBtn.addEventListener('click', () => !simulationRunning && startSimulation());
    resetSimBtn.addEventListener('click', resetSimulation);
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            tabBtns.forEach(b => {
                b.classList.remove('active', 'text-white');
                b.classList.add('text-gray-400');
            });
            btn.classList.add('active', 'text-white');
            btn.classList.remove('text-gray-400');
            tabContents.forEach(content => content.classList.add('hidden'));
            document.getElementById(`tab-${btn.dataset.tab}`).classList.remove('hidden');
        });
    });

    generateRecapBtn.addEventListener('click', async () => {
        const btn = generateRecapBtn;
        btn.disabled = true;
        btn.querySelector('.btn-text').textContent = 'Generating...';
        btn.querySelector('.spinner').classList.remove('hidden');
        
        await new Promise(res => setTimeout(res, 1500));
        recapSummaryEl.innerHTML = `
            <h4>Meeting Summary</h4>
            <p>The call addressed a multi-faceted crisis involving housing, benefits, and significant carer strain. Sarah, the client's daughter, expressed frustration with the current housing situation and the impact of an equity release on her mother's benefits.</p>
            <h4>Key Decisions</h4>
            <ul><li>An Occupational Therapy (OT) assessment will be arranged to support a housing band medical reassessment.</li><li>A comprehensive benefits review will be initiated.</li></ul>
            <h4>Action Items</h4>
            <ol><li><b>Advisor:</b> Refer client for an OT assessment (Priority).</li><li><b>Advisor:</b> Connect Sarah with Age UK's carer support services.</li><li><b>Advisor:</b> Schedule a follow-up call in 48 hours to confirm actions.</li></ol>
        `;
        
        btn.disabled = false;
        btn.querySelector('.btn-text').textContent = '✨ Regenerate Recap';
        btn.querySelector('.spinner').classList.add('hidden');
        saveRecapBtn.disabled = false;
    });

    saveRecapBtn.addEventListener('click', () => {
        saveFeedback.classList.remove('hidden');
        setTimeout(() => saveFeedback.classList.add('hidden'), 3000);
    });

    // --- Simulation Logic ---
    const conversationScript = [
        {
            speaker: 'Sarah (Daughter)',
            text: "Hello, I'm calling for my mum. She has severe mobility issues and has been on the council housing list for two years. We're so frustrated and also worried about her finances... she took out equity release on her home a while ago.",
            sentiment: 'negative',
            emotion: 'Frustrated',
            agentActions: {
                insights: ["Multi-layered crisis identified: Housing + Benefits + Financial concerns."],
                notes: "CALLER: Sarah (Daughter)\nTOPIC: Mother's housing & financial situation.\n- Severe mobility issues\n- 2 years on council list\n- Frustration evident\n- Concern over equity release & finances"
            }
        },
        {
            speaker: 'Advisor',
            text: "That sounds incredibly difficult, Sarah. You've been carrying a lot of worry. Can you tell me more about your mother's current living situation and her mobility needs?",
            sentiment: 'neutral',
            emotion: 'Empathetic',
            agentActions: {
                quality: ["✅ Excellent use of validation and empathy to build rapport."],
                suggestions: [
                    "Could you walk me through the specific challenges with her current flat?",
                    "It sounds incredibly stressful to manage all of this. How are you coping?",
                    "Let's focus on one thing at a time. We can start with the housing."
                ]
            }
        },
        {
            speaker: 'Sarah (Daughter)',
            text: "She's in a top-floor flat with no lift. She can barely get out anymore. We think she should have a higher banding because of her health, but we don't know how to prove it.",
            sentiment: 'negative',
            emotion: 'Anxious',
            agentActions: {
                insights: ["URGENT: Isolation risk - client 'can barely get out'.", "Housing band reassessment is the key procedural need."],
                knowledgeBase: "Displaying: 'OT Assessment Referral Process', 'Medical Evidence for Housing Applications'.",
                notes: "\n\nHOUSING DETAILS:\n- Top-floor flat, no lift\n- Client is effectively housebound (isolation risk)\n- GOAL: Achieve higher housing band on medical grounds."
            }
        },
        {
            speaker: 'Advisor',
            text: "I'm concerned about your mother's isolation, Sarah. We can definitely help with the housing reassessment - has she had an occupational therapy assessment? That would provide the medical evidence we need.",
            sentiment: 'positive',
            emotion: 'Professional',
            agentActions: {
                quality: ["✅ Excellent problem identification and suggestion of a clear, actionable next step (OT assessment)."],
                improvement: ["⭐ Opportunity: Explicitly validate the feeling of being overwhelmed by the process."]
            }
        },
        {
            speaker: 'Sarah (Daughter)',
            text: "No, she hasn't had an OT assessment. That sounds really helpful! I've been trying to research all this myself and it's been overwhelming. I'm her main carer and I'm getting stressed trying to navigate everything.",
            sentiment: 'positive',
            emotion: 'Relieved',
            agentActions: {
                insights: ["Carer strain confirmed - this is a critical support need.", "Information overload is a key pain point for the daughter."],
                knowledgeBase: "Surfacing: 'Carer Support Services Directory'.",
                notes: "\n\nCARER SITUATION:\n- Sarah is primary carer, experiencing stress.\n- Feels overwhelmed; needs structured guidance.\n- ACTION: Provide carer support info.",
                quality: ["✅ Good rapport established, daughter feels heard."]
            }
        },
        {
            speaker: 'Advisor',
            text: "Sarah, it sounds like you're doing an incredible job, but it's important we look after you too. Let me create a clear action plan so you don't have to navigate this alone. I'll also get you connected with our carers' support services.",
            sentiment: 'positive',
            emotion: 'Supportive',
            agentActions: {
                quality: ["🏆 Outstanding recognition of carer wellbeing. This is a best-practice example of person-centred support."],
                suggestions: [
                    "Let's schedule a follow-up for two days from now to check in.",
                    "I will email you a summary of this call with the next steps clearly listed.",
                    "Is there a good time for our carers' team to reach out to you directly?"
                ]
            }
        }
    ];

    function updateEmotionIndicator(emotion, sentiment) {
        const colors = { 'negative': 'bg-red-600', 'positive': 'bg-green-600', 'neutral': 'bg-blue-600' };
        const icons = { 'Frustrated': 'fa-frown', 'Anxious': 'fa-exclamation-triangle', 'Relieved': 'fa-smile', 'Grateful': 'fa-heart', 'Professional': 'fa-user-tie', 'Supportive': 'fa-hands-helping', 'Empathetic': 'fa-hand-holding-heart' };
        emotionIndicator.className = `absolute top-2 right-2 sm:top-4 sm:right-4 px-3 py-1 rounded-full text-xs font-semibold ${colors[sentiment] || 'bg-gray-600'}`;
        emotionIndicator.innerHTML = `<i class="fas ${icons[emotion] || 'fa-circle'} mr-1"></i>${emotion}`;
    }

    function resetSimulation() {
        if(timerInterval) clearInterval(timerInterval);
        meetingTimerEl.textContent = '01:33';
        statusIndicator.classList.remove('bg-red-500');
        statusIndicator.classList.add('bg-green-500');


        transcriptEl.innerHTML = '<p class="text-gray-400 italic">Conversation will appear here...</p>';
        suggestionsEl.innerHTML = '<li class="text-gray-500">Suggestions will appear here...</li>';
        knowledgeBaseEl.innerHTML = '<p class="text-gray-500 flex items-center"><i class="fas fa-search mr-2"></i>Knowledge Base is ready.</p>';
        insightsEl.innerHTML = '<p class="text-gray-500">AI insights will be generated here...</p>';
        loopNotesEl.value = '';
        qualityIndicatorsEl.innerHTML = '<li class="text-gray-500">Quality analysis will appear here.</li>';
        improvementSuggestionsEl.innerHTML = '<li class="text-gray-500">Feedback will appear here.</li>';
        recapSummaryEl.innerHTML = '<p class="text-gray-500">Generate a recap after the demo.</p>';

        fullTranscript = [];
        currentStep = 0;
        simulationRunning = false;
        
        agentActivity.textContent = 'Ready to assist';
        updateEmotionIndicator('Ready', 'neutral');

        startSimBtn.innerHTML = '<i class="fas fa-play mr-1"></i>Start Demo';
        startSimBtn.disabled = false;
        startSimBtn.classList.replace('bg-gray-600', 'bg-green-600');
        generateRecapBtn.disabled = true;
        saveRecapBtn.disabled = true;
    }

    function startSimulation() {
        resetSimulation();
        simulationRunning = true;
        startSimBtn.innerHTML = '<i class="fas fa-pause mr-1"></i>Demo Running';
        startSimBtn.disabled = true;
        startSimBtn.classList.replace('bg-green-600', 'bg-gray-600');
        statusIndicator.classList.remove('bg-green-500');
        statusIndicator.classList.add('bg-red-500');
        
        // Start Timer
        secondsElapsed = 93;
        timerInterval = setInterval(() => {
            secondsElapsed++;
            const minutes = Math.floor(secondsElapsed / 60).toString().padStart(2, '0');
            const seconds = (secondsElapsed % 60).toString().padStart(2, '0');
            meetingTimerEl.textContent = `${minutes}:${seconds}`;
        }, 1000);

        transcriptEl.innerHTML = '';
        insightsEl.innerHTML = '';
        qualityIndicatorsEl.innerHTML = '';
        improvementSuggestionsEl.innerHTML = '';
        runNextStep();
    }

    function runNextStep() {
        if (currentStep >= conversationScript.length) {
            simulationRunning = false;
            agentActivity.textContent = 'Analysis complete';
            startSimBtn.innerHTML = '<i class="fas fa-refresh mr-1"></i>Restart Demo';
            startSimBtn.disabled = false;
            generateRecapBtn.disabled = false;
            if(timerInterval) clearInterval(timerInterval); // Stop timer at the end
            statusIndicator.classList.remove('bg-red-500');
            statusIndicator.classList.add('bg-green-500');
            return;
        }

        const step = conversationScript[currentStep];
        agentActivity.textContent = `Analyzing ${step.speaker}...`;

        setTimeout(() => {
            fullTranscript.push(step);

            const transcriptLine = document.createElement('div');
            transcriptLine.className = 'border-l-2 border-gray-600 pl-3 py-2';
            transcriptLine.innerHTML = `<strong class="sentiment-${step.sentiment}">${step.speaker}:</strong><br><span class="text-sm">${step.text}</span>`;
            transcriptEl.appendChild(transcriptLine);
            transcriptEl.scrollTop = transcriptEl.scrollHeight;

            if (step.emotion) updateEmotionIndicator(step.emotion, step.sentiment);

            const actions = step.agentActions;
            if (actions) {
                if(actions.insights) insightsEl.innerHTML = actions.insights.map(i => `<div class="p-2 bg-gray-800 rounded flex items-start"><i class="fas fa-lightbulb text-amber-400 mr-2 mt-1"></i><span>${i}</span></div>`).join('');
                if(actions.suggestions) suggestionsEl.innerHTML = actions.suggestions.map(s => `<li class="p-2 bg-gray-800 rounded flex items-start hover:bg-gray-700 cursor-pointer"><i class="fas fa-comment text-yellow-400 mr-2 mt-1"></i><span>${s}</span></li>`).join('');
                if(actions.knowledgeBase) knowledgeBaseEl.innerHTML = `<div class="p-2 bg-gray-800 rounded flex items-start"><i class="fas fa-book-open text-green-400 mr-2 mt-1"></i><span>${actions.knowledgeBase}</span></div>`;
                if(actions.notes) loopNotesEl.value += actions.notes;
                if(actions.quality) actions.quality.forEach(q => qualityIndicatorsEl.innerHTML += `<li class="flex items-start p-2 bg-gray-800 rounded mb-2">${q}</li>`);
                if(actions.improvement) improvementSuggestionsEl.innerHTML = `<li class="flex items-start p-2 bg-gray-800 rounded">${actions.improvement}</li>`;
            }
            
            currentStep++;
            setTimeout(runNextStep, 3500);
        }, 1000);
    }
    
    resetSimulation();
});
</script>
</body>
</html>

